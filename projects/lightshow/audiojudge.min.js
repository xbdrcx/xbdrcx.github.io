// AudioJudge v1.0 (Lightshow adaptation), Bruno Cruz 2024 @ https://www.github.com/xbdrcx
var player=document.getElementById("player");let file_importers=document.getElementsByClassName("fileimporter");const playButtons=document.getElementsByClassName("playBtn");function fileUpload(e){var t=window.URL||window.webkitURL,l=e.type,n=!0;""===n&&(n="no"),file_type=l.split("/")[0],console.log(file_type);var a='Can play type "'+l+'": '+n;console.log(a),audiobeenpaused=!1;var o=t.createObjectURL(e);player.src=o}const autolightsButtons=document.getElementsByClassName("autolightsBtn");for(let i=0;i<autolightsButtons.length;i++)autolightsButtons[i].addEventListener("click",function(){file_importers[i].click()});for(let i=0;i<file_importers.length;i++)file_importers[i].addEventListener("change",function(){fileUpload(this.files[0])});window.onload=function(){for(let e=0;e<file_importers.length;e++)file_importers[e].onchange=function(){var e,t=this.files;player.src=URL.createObjectURL(t[0]),player.load();var l=new AudioContext,n=l.createMediaElementSource(player),a=l.createAnalyser(),o=document.getElementById("canvas");o.width=1600,o.height=800;var r=o.getContext("2d");n.connect(a),a.connect(l.destination),a.fftSize=256;var s=a.frequencyBinCount;console.log(s);var c=new Uint8Array(s),$=o.width,p=o.height,y=$/s*1.5,f=0,u=0,d=0,g=0,h=0;function B(){requestAnimationFrame(B),u=0,d=0,g=0,h=0,f=0,a.getByteFrequencyData(c),r.fillStyle="#000",r.fillRect(0,0,$,p);for(var t=0;t<s;t++){var l=e=c[t],n=t/s+e,o=e;r.fillStyle="rgb("+l+","+n+","+o+")",r.fillRect(f,p-3*e,y,3*e),f+=y+1,t<=32?u+=e/31:t<=64?d+=e/31:t<=97?g+=e/31:t<=128&&(h+=e/31)}group=[u=u>90?1:0,d=d>90?1:0,g=g>90?1:0,h=h>90?1:0],console.log(group),autoLights(group)}for(let m=0;m<playButtons.length;m++)playButtons[m].removeAttribute("disabled"),playButtons[m].addEventListener("click",function(){ligthsPlaying?(ligthsPlaying=!1,playButtons[m].children[0].src="../icons/play-white.ico",player.pause()):(ligthsPlaying=!0,playButtons[m].children[0].src="../icons/pause-white.ico",player.play(),B())});player.addEventListener("ended",function(){ligthsPlaying=!1;for(let e=0;e<playButtons.length;e++)playButtons[e].children[0].src="../icons/play-white.ico";menuState||(menuState=!0,menuContainer.style.opacity="1")})}};